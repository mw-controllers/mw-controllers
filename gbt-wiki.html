<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="GB/T Controller Wiki – техническая документация контроллеров зарядных станций GB/T. GB/T 27930, SAE J1939. MW Controllers.">
    <meta name="keywords" content="GB/T wiki, контроллер зарядной станции GB/T, EVSE, GB/T 27930, CAN">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://mw-controllers.by/gbt-wiki.html">
    <link rel="alternate" hreflang="ru" href="https://mw-controllers.by/gbt-wiki.html">
    <link rel="alternate" hreflang="en" href="https://mw-controllers.by/en/gbt-wiki.html">
    <link rel="alternate" hreflang="x-default" href="https://mw-controllers.by/gbt-wiki.html">
    <title>GB/T Контроллер Вики | MW Controllers</title>
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <meta name="apple-mobile-web-app-title" content="MW Controllers">
    <link rel="manifest" href="/site.webmanifest">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://mw-controllers.by/gbt-wiki.html">
    <meta property="og:title" content="GB/T Контроллер Вики | MW Controllers">
    <meta property="og:description" content="Техническая документация контроллеров зарядных станций GB/T. GB/T 27930.">
    <meta property="og:locale" content="ru_BY">
    <meta property="og:site_name" content="MW Controllers">
    <meta name="twitter:card" content="summary">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">
    <link rel="stylesheet" href="css/site.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="theme-gbt">
    <div id="navbar-placeholder" data-lang="ru"></div>

    <section class="hero">
        <div class="hero-content">
            <div class="hero-icon">
                <img src="img/gbt_icon.png" alt="GB/T Icon" style="width:100%; height:100%; object-fit: contain;">
            </div>
            <h1 class="text-xxl">GB/T Контроллер Вики</h1>
            <p class="text-large">Техническая документация и спецификации для контроллеров зарядки GB/T</p>
        </div>
    </section>

    <main class="container">
        <section class="columns">
            <div class="column col-12">
                <h2 class="section-title">Обзор</h2>
                <div class="card p-2">
                    <p style="color: #e03e2d; text-decoration: underline;">Описание стандарта не претендует на абсолютное соответствие официальной документации, это наша интерпретация с собственной аппаратной и программной реализацией.</p>
                    <h6 style="margin-bottom: 0.5rem; color: var(--accent); font-size: 0.95rem;">Характеристики разъёма GB/T 20234.3 DC:</h6>
                    <ul class="state-list" style="list-style: none; margin: 0; padding: 0; display: flex; flex-direction: column; gap: 0.5rem;">
                        <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 8rem;">Номинальное напряжение:</span> 750 В / 1000 В DC</li>
                        <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 8rem;">Доступный ток:</span> 80 А, 125 А, 200 А, 250 А</li>
                        <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 8rem;">Максимальная мощность:</span> 250 кВт</li>
                    </ul>
                    <div class="figures-inline" style="display: flex; flex-wrap: wrap; gap: 2rem; align-items: flex-end; justify-content: center; margin: 1rem 0;">
                        <figure style="margin: 0; text-align: center; flex: 0 0 auto;">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/GBT_20234_%28DC%29.svg/500px-GBT_20234_%28DC%29.svg.png" alt="GB/T 18487.1-2015" style="width: 300px; height: auto; object-fit: contain;">
                            <figcaption style="font-size: 0.85rem; color: #666; margin-top: 0.25rem;">Разъём GB/T 18487.1-2015</figcaption>
                        </figure>
                        <ul style="list-style: none; margin: 0; padding: 0; display: flex; flex-direction: column; gap: 0.5rem;">
                            <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 3rem;">S+ / S−</span> — Связь для зарядки	CAN_H / CAN_L</li>
                            <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 3rem;">CC1 / CC2</span> — Подтверждение зарядки, сигнализация после вставки</li>
                            <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 3rem;">PE</span> — Защитное заземление</li>
                            <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 3rem;">DC+ / DC-</span> — Основное питание DC	положительный / отрицательный</li>
                            <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 3rem;">A+ / A−</span> — Вспомогательное питание DC 12В +/-5%, 10А</li>
                        </ul>
                    </div>
                </div>
                </div>
            </div>
        </section>

        <section class="columns">
            <div class="column col-12">
                <h2 class="section-title">Аппаратная часть</h2>
                <div class="card p-2">
                    <figure style="margin: 0; text-align: center; flex: 0 0 auto;">
                        <img src="img/gbt_wiki/hardware.png" alt="GBT Hardware" style="width: 90%; max-width: 900px; height: auto; object-fit: contain; display: block; margin-left: auto; margin-right: auto;">
                        <figcaption style="font-size: 0.85rem; color: #666; margin-top: 0.25rem;">Последовательная схема</figcaption>
                    </figure>
                </div>
                </div>
                <div class="column col-12">
                <h2 class="section-title">Программная часть</h2>
                <p>Стандарт зарядки по кабелю GB/T 27930 основан на сетевом протоколе SAE J1939 и использует шину CAN с соединением точка-точка.</p>
                <p>Стандарт основан на спецификации CAN 2.0 со скоростью обмена 250 кбит/с и 29-битным идентификатором.</p>
                <p>Стандарт широко используется в современных транспортных средствах в качестве основного стандарта связи для модулей транспортного средства.</p>
                <p>Протокол основан на системе PGN и SPN. Где PGN является частью 29-битного идентификатора, а SPN — это информация полезной нагрузки, расположенная в определённом месте в битовом поле 8-байтового сообщения.</p>
                    <div class="card p-2">
                        <figure style="margin: 0; text-align: center; flex: 0 0 auto;">
                            <img src="img/gbt_wiki/frame.png" alt="Structure of a standard message" style="width: 90%; max-width: 900px; height: auto; object-fit: contain; display: block; margin-left: auto; margin-right: auto;">
                            <figcaption style="font-size: 0.85rem; color: #666; margin-top: 0.25rem;">Структура стандартного сообщения</figcaption>
                        </figure>
                    </div>
                    <p>Основным недостатком спецификации CAN 2.0 является ограниченная длина кадра, не более 8 байт.</p>
                    <p>Ограничение длины кадра в стандарте SAE J1939 было решено на программном уровне. Было введен так называемый "Транспортный Уровень" (Transport Layer).</p>
                    <div class="card p-2" style="margin-top: 1rem;">
                        <h6 style="margin-bottom: 0.75rem; color: var(--accent); font-size: 0.95rem;">Принцип формирования 29-битного идентификатора для CAN 2.0B:</h6>
                        <pre class="line-numbers" style="background: #1e1e1e; padding: 1rem; border-radius: 8px; overflow-x: auto; margin: 0;"><code class="language-c">const uint8_t addressBMS = 0xF4;
const uint8_t addressCHA = 0x56;
uint32_t id = (priority << 26) | ((pgn | (uint8_t)addressBMS) << 8) | (uint8_t)addressCHA;
/* "pgn", "priority" is specified in the tables of the GB/T 27930-2015 standard. */</code></pre>
                    </div>
                    <div class="card p-2" style="margin-top: 1rem;">
                        <h6 style="margin-bottom: 0.75rem; color: var(--accent); font-size: 0.95rem;">Тестовый код для справки:</h6>
                        <pre class="line-numbers" style="background: #1e1e1e; padding: 1rem; border-radius: 8px; overflow-x: auto; margin: 0;"><code class="language-c">const uint8_t addressBMS = 0xF4;
const uint8_t addressCHA = 0x56;
const uint8_t START_FRAME_PGN = 0xEC00;
const uint8_t NEXT_FRAME_PGN = 0xEB00;
uint8_t data[8];
const uint8_t CM_RTS = 0x10;
const uint8_t CM_CTS = 0x11;
const uint8_t CM_EndOfMsgACK = 0x13;

/* For example PGN for transmit = 0xFFEB;
   priority = 6;
   data for transmit: payload[28] = {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27}
*/
uint16_t pgn = 0xFFEB;
uint8_t payload[28] = {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27};

const uint32_t ID_NEXT_FRAME = (priority << 26) | ((NEXT_FRAME_PGN | (uint8_t)addressBMS) << 8) | (uint8_t)addressCHA;

uint16_t size = sizeof(payload);
uint8_t num_of_packets = (size / 7) + ((size % 7) ? 1 : 0);

/* Connection Initiation STEP 1 */
const uint32_t ID_START_FRAME = (priority << 26) | ((START_FRAME_PGN | (uint8_t)addressBMS) << 8) | (uint8_t)addressCHA;
const uint32_t ID_START_FRAME_CTS = (priority << 26) | ((START_FRAME_PGN | (uint8_t)addressCHA) << 8) | (uint8_t)addressBMS;
const uint32_t ID_END_FRAME_ACK = (priority << 26) | ((START_FRAME_PGN | (uint8_t)addressCHA) << 8) | (uint8_t)addressBMS;

data[0] = CM_RTS;
data[1] = (uint8_t)size;
data[2] = (uint8_t)(size >> 8);
data[3] = num_of_packets;
data[4] = 0xFF;
data[5] = (uint8_t)pgn;
data[6] = (uint8_t)(pgn >> 8);
data[7] = 0;
sendMsg(ID_START_FRAME, data, sizeof(data)); // send message to can

/* Step by step we should send 7 bytes of payload, data[0] indicate number of packet, empty bytes we should fill by 0xFF */
/* detailed see below */
                            </code></pre>
                    </div>
                    <figure style="margin: 0; text-align: center; flex: 0 0 auto;">
                        <img src="img/gbt_wiki/communicate.png" alt="Structure of a standard message" style="width: 90%; max-width: 900px; height: auto; object-fit: contain; display: block; margin-left: auto; margin-right: auto;">
                        <figcaption style="font-size: 0.85rem; color: #666; margin-top: 0.25rem;">Диаграмма процесса отправки длинного PGN от контроллера зарядки к электромобилю:</figcaption>
                    </figure>
                    <div class="card p-2" style="margin-top: 1rem;">
                        <h6 style="margin-bottom: 0.75rem; color: var(--accent); font-size: 0.95rem;">Таблица: Классификация сообщений на этапе рукопожатия зарядки</h6>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">
                                <thead>
                                    <tr style="background: var(--chip-bg); border-bottom: 2px solid var(--accent);">
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 700; color: var(--accent);">Message code</th>
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 700; color: var(--accent);">Message description</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">PGN (Dec)</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">PGN (Hex)</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">Priority</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">Data length byte</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">Message period ms</th>
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 700; color: var(--accent);">Source address-destination address</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1);">
                                        <td style="padding: 0.75rem; font-weight: 600;">CHM</td>
                                        <td style="padding: 0.75rem;">Charger handshake</td>
                                        <td style="padding: 0.75rem; text-align: center;">9728</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">002600H</td>
                                        <td style="padding: 0.75rem; text-align: center;">6</td>
                                        <td style="padding: 0.75rem; text-align: center;">3</td>
                                        <td style="padding: 0.75rem; text-align: center;">250</td>
                                        <td style="padding: 0.75rem;">Charger → BMS</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1); background: rgba(0,0,0,0.02);">
                                        <td style="padding: 0.75rem; font-weight: 600;">BHM</td>
                                        <td style="padding: 0.75rem;">Vehicle handshake</td>
                                        <td style="padding: 0.75rem; text-align: center;">9984</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">002700H</td>
                                        <td style="padding: 0.75rem; text-align: center;">6</td>
                                        <td style="padding: 0.75rem; text-align: center;">2</td>
                                        <td style="padding: 0.75rem; text-align: center;">250</td>
                                        <td style="padding: 0.75rem;">BMS → Charger</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1);">
                                        <td style="padding: 0.75rem; font-weight: 600;">CRM</td>
                                        <td style="padding: 0.75rem;">Charger recognition</td>
                                        <td style="padding: 0.75rem; text-align: center;">256</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">000100H</td>
                                        <td style="padding: 0.75rem; text-align: center;">6</td>
                                        <td style="padding: 0.75rem; text-align: center;">8</td>
                                        <td style="padding: 0.75rem; text-align: center;">250</td>
                                        <td style="padding: 0.75rem;">Charger → BMS</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1); background: rgba(0,0,0,0.02);">
                                        <td style="padding: 0.75rem; font-weight: 600;">BRM</td>
                                        <td style="padding: 0.75rem;">BMS and vehicle identification message</td>
                                        <td style="padding: 0.75rem; text-align: center;">512</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">000200H</td>
                                        <td style="padding: 0.75rem; text-align: center;">7</td>
                                        <td style="padding: 0.75rem; text-align: center;">41</td>
                                        <td style="padding: 0.75rem; text-align: center;">250</td>
                                        <td style="padding: 0.75rem;">BMS → Charger</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card p-2" style="margin-top: 1rem;">
                        <h6 style="margin-bottom: 0.75rem; color: var(--accent); font-size: 0.95rem;">Таблица: Классификация сообщений на этапе конфигурации параметров зарядки</h6>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">
                                <thead>
                                    <tr style="background: var(--chip-bg); border-bottom: 2px solid var(--accent);">
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 700; color: var(--accent);">Код сообщения</th>
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 700; color: var(--accent);">Описание сообщения</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">PGN (Dec)</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">PGN (Hex)</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">Приоритет</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">Длина данных (байт)</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">Период сообщения (мс)</th>
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 700; color: var(--accent);">Адрес источника-адрес назначения</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1);">
                                        <td style="padding: 0.75rem; font-weight: 600;">BCP</td>
                                        <td style="padding: 0.75rem;">Charging parameters of power storage battery</td>
                                        <td style="padding: 0.75rem; text-align: center;">1536</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">000600H</td>
                                        <td style="padding: 0.75rem; text-align: center;">7</td>
                                        <td style="padding: 0.75rem; text-align: center;">13</td>
                                        <td style="padding: 0.75rem; text-align: center;">500</td>
                                        <td style="padding: 0.75rem;">BMS → Charger</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1); background: rgba(0,0,0,0.02);">
                                        <td style="padding: 0.75rem; font-weight: 600;">CTS</td>
                                        <td style="padding: 0.75rem;">Charger send-time synchronization information</td>
                                        <td style="padding: 0.75rem; text-align: center;">1792</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">000700H</td>
                                        <td style="padding: 0.75rem; text-align: center;">6</td>
                                        <td style="padding: 0.75rem; text-align: center;">7</td>
                                        <td style="padding: 0.75rem; text-align: center;">500</td>
                                        <td style="padding: 0.75rem;">Charger → BMS</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1);">
                                        <td style="padding: 0.75rem; font-weight: 600;">CML</td>
                                        <td style="padding: 0.75rem;">Charger's maximum output</td>
                                        <td style="padding: 0.75rem; text-align: center;">2048</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">000800H</td>
                                        <td style="padding: 0.75rem; text-align: center;">6</td>
                                        <td style="padding: 0.75rem; text-align: center;">8</td>
                                        <td style="padding: 0.75rem; text-align: center;">250</td>
                                        <td style="padding: 0.75rem;">Charger → BMS</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 MW Controllers. GB/T Контроллер Вики.</p>
    </footer>
    <script src="js/navbar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>Prism.highlightAll();</script>
</body>
</html>

