<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="GB/T Controller Wiki - Technical documentation and specifications for GB/T charging controllers">
    <title>GB/T Controller Wiki | MW Controllers</title>
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">
    <link rel="stylesheet" href="../css/site.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="theme-gbt">
    <div id="navbar-placeholder" data-lang="en"></div>

    <section class="hero">
        <div class="hero-content">
            <div class="hero-icon">
                <img src="../img/gbt_icon.png" alt="GB/T Icon" style="width:100%; height:100%; object-fit: contain;">
            </div>
            <h1 class="text-xxl">GB/T Controller Wiki</h1>
            <p class="text-large">Technical documentation and specifications for GB/T charging controllers</p>
        </div>
    </section>

    <main class="container">
        <section class="columns">
            <div class="column col-12">
                <h2 class="section-title">Overview</h2>
                <div class="card p-2">
                    <p style="color: #e03e2d; text-decoration: underline;">The description of the standard does not claim to be in absolute compliance with the official documentation, it is our interpretation with its own hardware and software implementation.</p>
                    <h6 style="margin-bottom: 0.5rem; color: var(--accent); font-size: 0.95rem;">GB/T 20234.3 DC connector specifications:</h6>
                    <ul class="state-list" style="list-style: none; margin: 0; padding: 0; display: flex; flex-direction: column; gap: 0.5rem;">
                        <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 8rem;">Rated voltage:</span> 750 V / 1000 V DC</li>
                        <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 8rem;">Available current:</span> 80 A, 125 A, 200 A, 250 A</li>
                        <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 8rem;">Max power:</span> 250 kW</li>
                    </ul>
                    <div class="figures-inline" style="display: flex; flex-wrap: wrap; gap: 2rem; align-items: flex-end; justify-content: center; margin: 1rem 0;">
                        <figure style="margin: 0; text-align: center; flex: 0 0 auto;">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/GBT_20234_%28DC%29.svg/500px-GBT_20234_%28DC%29.svg.png" alt="GB/T 18487.1-2015" style="width: 300px; height: auto; object-fit: contain;">
                            <figcaption style="font-size: 0.85rem; color: #666; margin-top: 0.25rem;">GB/T 18487.1-2015 connector</figcaption>
                        </figure>
                        <ul style="list-style: none; margin: 0; padding: 0; display: flex; flex-direction: column; gap: 0.5rem;">
                            <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 3rem;">S+ / S−</span> — Charging communication	CAN_H / CAN_L</li>
                            <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 3rem;">CC1 / CC2</span> — Charging confirmation	post-insertion signalling</li>
                            <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 3rem;">PE</span> — Protective earth	full-current protective earthing system</li>
                            <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 3rem;">DC+ / DC-</span> — Main DC power	positive / negative</li>
                            <li style="display: flex; align-items: baseline; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--chip-bg); border-radius: 8px; border-left: 3px solid var(--accent);"><span style="font-weight: 700; color: var(--accent); min-width: 3rem;">A+ / A−</span> — Auxiliary DC power 12V +/-5%, 10A</li>
                        </ul>
                    </div>
                </div>
                </div>
            </div>
        </section>

        <section class="columns">
            <div class="column col-12">
                <h2 class="section-title">Hardware</h2>
                <div class="card p-2">
                    <figure style="margin: 0; text-align: center; flex: 0 0 auto;">
                        <img src="../img/gbt_wiki/hardware.png" alt="GBT Hardware" style="width: 90%; max-width: 900px; height: auto; object-fit: contain; display: block; margin-left: auto; margin-right: auto;">
                        <figcaption style="font-size: 0.85rem; color: #666; margin-top: 0.25rem;">Sequence circuit</figcaption>
                    </figure>
                </div>
                </div>
                <div class="column col-12">
                <h2 class="section-title">Software part</h2>
                <p>Cable charging standard GB/T 27930 is based on the SAE J1939 network protocol and uses the CAN bus with a point-to-point connection.</p>
                <p>This standard is based on the CAN 2.0 specification with an exchange rate of 250 kbit/s, and an 29-bit identifier.</p>
                <p>This standard is widely used in modern vehicles as the primary communication standard for vehicle modules.</p>
                <p>The protocol is based on the PGN and SPN system. Where the PGN is part of a 29-bit identifier, and the SPN is the payload information located in a specific location within the bit field of an 8-byte message.</p>
                    <div class="card p-2">
                        <figure style="margin: 0; text-align: center; flex: 0 0 auto;">
                            <img src="../img/gbt_wiki/frame.png" alt="Structure of a standard message" style="width: 90%; max-width: 900px; height: auto; object-fit: contain; display: block; margin-left: auto; margin-right: auto;">
                            <figcaption style="font-size: 0.85rem; color: #666; margin-top: 0.25rem;">Structure of a standard message</figcaption>
                        </figure>
                    </div>
                    <p>The main drawback of the CAN 2.0 specification is the limited frame length, no more than 8 bytes.</p>
                    <p>The frame length limitation in the SAE J1939 standard was addressed at the software level. The so-called "Transport Layer" was introduced.</p>
                    <div class="card p-2" style="margin-top: 1rem;">
                        <h6 style="margin-bottom: 0.75rem; color: var(--accent); font-size: 0.95rem;">The principle of forming a 29-bit identifier for CAN 2.0B:</h6>
                        <pre class="line-numbers" style="background: #1e1e1e; padding: 1rem; border-radius: 8px; overflow-x: auto; margin: 0;"><code class="language-c">const uint8_t addressBMS = 0xF4;
const uint8_t addressCHA = 0x56;
uint32_t id = (priority << 26) | ((pgn | (uint8_t)addressBMS) << 8) | (uint8_t)addressCHA;
/* "pgn", "priority" is specified in the tables of the GB/T 27930-2015 standard. */</code></pre>
                    </div>
                    <div class="card p-2" style="margin-top: 1rem;">
                        <h6 style="margin-bottom: 0.75rem; color: var(--accent); font-size: 0.95rem;">Test code for reference:</h6>
                        <pre class="line-numbers" style="background: #1e1e1e; padding: 1rem; border-radius: 8px; overflow-x: auto; margin: 0;"><code class="language-c">const uint8_t addressBMS = 0xF4;
const uint8_t addressCHA = 0x56;
const uint8_t START_FRAME_PGN = 0xEC00;
const uint8_t NEXT_FRAME_PGN = 0xEB00;
uint8_t data[8];
const uint8_t CM_RTS = 0x10;
const uint8_t CM_CTS = 0x11;
const uint8_t CM_EndOfMsgACK = 0x13;

/* For example PGN for transmit = 0xFFEB;
   priority = 6;
   data for transmit: payload[28] = {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27}
*/
uint16_t pgn = 0xFFEB;
uint8_t payload[28] = {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27};

const uint32_t ID_NEXT_FRAME = (priority << 26) | ((NEXT_FRAME_PGN | (uint8_t)addressBMS) << 8) | (uint8_t)addressCHA;

uint16_t size = sizeof(payload);
uint8_t num_of_packets = (size / 7) + ((size % 7) ? 1 : 0);

/* Connection Initiation STEP 1 */
const uint32_t ID_START_FRAME = (priority << 26) | ((START_FRAME_PGN | (uint8_t)addressBMS) << 8) | (uint8_t)addressCHA;
const uint32_t ID_START_FRAME_CTS = (priority << 26) | ((START_FRAME_PGN | (uint8_t)addressCHA) << 8) | (uint8_t)addressBMS;
const uint32_t ID_END_FRAME_ACK = (priority << 26) | ((START_FRAME_PGN | (uint8_t)addressCHA) << 8) | (uint8_t)addressBMS;

data[0] = CM_RTS;
data[1] = (uint8_t)size;
data[2] = (uint8_t)(size >> 8);
data[3] = num_of_packets;
data[4] = 0xFF;
data[5] = (uint8_t)pgn;
data[6] = (uint8_t)(pgn >> 8);
data[7] = 0;
sendMsg(ID_START_FRAME, data, sizeof(data)); // send message to can

/* Step by step we should send 7 bytes of payload, data[0] indicate number of packet, empty bytes we should fill by 0xFF */
/* detailed see below */
                            </code></pre>
                    </div>
                    <figure style="margin: 0; text-align: center; flex: 0 0 auto;">
                        <img src="../img/gbt_wiki/communicate.png" alt="Structure of a standard message" style="width: 90%; max-width: 900px; height: auto; object-fit: contain; display: block; margin-left: auto; margin-right: auto;">
                        <figcaption style="font-size: 0.85rem; color: #666; margin-top: 0.25rem;">The diagram showing the process of sending a long PGN from the charging controller to the electric vehicle:</figcaption>
                    </figure>
                    <div class="card p-2" style="margin-top: 1rem;">
                        <h6 style="margin-bottom: 0.75rem; color: var(--accent); font-size: 0.95rem;">Table 3: Classification of Messages During Charging Handshake Stage</h6>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">
                                <thead>
                                    <tr style="background: var(--chip-bg); border-bottom: 2px solid var(--accent);">
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 700; color: var(--accent);">Message code</th>
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 700; color: var(--accent);">Message description</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">PGN (Dec)</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">PGN (Hex)</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">Priority</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">Data length byte</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">Message period ms</th>
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 700; color: var(--accent);">Source address-destination address</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1);">
                                        <td style="padding: 0.75rem; font-weight: 600;">CHM</td>
                                        <td style="padding: 0.75rem;">Charger handshake</td>
                                        <td style="padding: 0.75rem; text-align: center;">9728</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">002600H</td>
                                        <td style="padding: 0.75rem; text-align: center;">6</td>
                                        <td style="padding: 0.75rem; text-align: center;">3</td>
                                        <td style="padding: 0.75rem; text-align: center;">250</td>
                                        <td style="padding: 0.75rem;">Charger → BMS</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1); background: rgba(0,0,0,0.02);">
                                        <td style="padding: 0.75rem; font-weight: 600;">BHM</td>
                                        <td style="padding: 0.75rem;">Vehicle handshake</td>
                                        <td style="padding: 0.75rem; text-align: center;">9984</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">002700H</td>
                                        <td style="padding: 0.75rem; text-align: center;">6</td>
                                        <td style="padding: 0.75rem; text-align: center;">2</td>
                                        <td style="padding: 0.75rem; text-align: center;">250</td>
                                        <td style="padding: 0.75rem;">BMS → Charger</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1);">
                                        <td style="padding: 0.75rem; font-weight: 600;">CRM</td>
                                        <td style="padding: 0.75rem;">Charger recognition</td>
                                        <td style="padding: 0.75rem; text-align: center;">256</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">000100H</td>
                                        <td style="padding: 0.75rem; text-align: center;">6</td>
                                        <td style="padding: 0.75rem; text-align: center;">8</td>
                                        <td style="padding: 0.75rem; text-align: center;">250</td>
                                        <td style="padding: 0.75rem;">Charger → BMS</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1); background: rgba(0,0,0,0.02);">
                                        <td style="padding: 0.75rem; font-weight: 600;">BRM</td>
                                        <td style="padding: 0.75rem;">BMS and vehicle identification message</td>
                                        <td style="padding: 0.75rem; text-align: center;">512</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">000200H</td>
                                        <td style="padding: 0.75rem; text-align: center;">7</td>
                                        <td style="padding: 0.75rem; text-align: center;">41</td>
                                        <td style="padding: 0.75rem; text-align: center;">250</td>
                                        <td style="padding: 0.75rem;">BMS → Charger</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card p-2" style="margin-top: 1rem;">
                        <h6 style="margin-bottom: 0.75rem; color: var(--accent); font-size: 0.95rem;">Table 4: Classification of Messages During Charging Parameter Configuration Stage</h6>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">
                                <thead>
                                    <tr style="background: var(--chip-bg); border-bottom: 2px solid var(--accent);">
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 700; color: var(--accent);">Message code</th>
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 700; color: var(--accent);">Message description</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">PGN (Dec)</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">PGN (Hex)</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">Priority</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">Data length byte</th>
                                        <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: var(--accent);">Message period ms</th>
                                        <th style="padding: 0.75rem; text-align: left; font-weight: 700; color: var(--accent);">Source address-destination address</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1);">
                                        <td style="padding: 0.75rem; font-weight: 600;">BCP</td>
                                        <td style="padding: 0.75rem;">Charging parameters of power storage battery</td>
                                        <td style="padding: 0.75rem; text-align: center;">1536</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">000600H</td>
                                        <td style="padding: 0.75rem; text-align: center;">7</td>
                                        <td style="padding: 0.75rem; text-align: center;">13</td>
                                        <td style="padding: 0.75rem; text-align: center;">500</td>
                                        <td style="padding: 0.75rem;">BMS → Charger</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1); background: rgba(0,0,0,0.02);">
                                        <td style="padding: 0.75rem; font-weight: 600;">CTS</td>
                                        <td style="padding: 0.75rem;">Charger send-time synchronization information</td>
                                        <td style="padding: 0.75rem; text-align: center;">1792</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">000700H</td>
                                        <td style="padding: 0.75rem; text-align: center;">6</td>
                                        <td style="padding: 0.75rem; text-align: center;">7</td>
                                        <td style="padding: 0.75rem; text-align: center;">500</td>
                                        <td style="padding: 0.75rem;">Charger → BMS</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.1);">
                                        <td style="padding: 0.75rem; font-weight: 600;">CML</td>
                                        <td style="padding: 0.75rem;">Charger's maximum output</td>
                                        <td style="padding: 0.75rem; text-align: center;">2048</td>
                                        <td style="padding: 0.75rem; text-align: center; font-family: monospace;">000800H</td>
                                        <td style="padding: 0.75rem; text-align: center;">6</td>
                                        <td style="padding: 0.75rem; text-align: center;">8</td>
                                        <td style="padding: 0.75rem; text-align: center;">250</td>
                                        <td style="padding: 0.75rem;">Charger → BMS</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 MW Controllers. GB/T Controller Wiki.</p>
    </footer>
    <script src="../js/navbar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>Prism.highlightAll();</script>
</body>
</html>
